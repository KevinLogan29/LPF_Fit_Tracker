<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #7ed957; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    th, td { border: 1px solid #7ed957; padding: 6px; text-align: center; }
    th { background: #222; }
    button { background: #7ed957; border: none; padding: 5px 10px; margin: 2px; border-radius: 5px; cursor: pointer; }
    button:hover { background: #5bb946; }
    textarea { width: 100%; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Workout Tracker</h1>

  <table id="workout-table">
    <thead>
      <tr>
        <th>Exercise</th><th>Sets</th><th>Weight</th><th>∆Weight</th><th>Reps</th>
        <th>RIR</th><th>Pump</th><th>Felt</th><th>Rest</th><th>e1RM</th><th>Actions</th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
    <tfoot>
      <tr>
        <td colspan="9" id="total-volume">
          Total Volume: 0 lbs | Total Sets: 0 | Volume Category: Low
        </td>
        <td colspan="2">
          <button onclick="addSet()">Add Set</button>
          <button onclick="saveWorkout()">Save Workout</button>
        </td>
      </tr>
    </tfoot>
  </table>

  <h3>Notes</h3>
  <textarea id="notes" rows="4" placeholder="Additional notes..."></textarea>

  <script>
    function addSet(exercise = "", sets = 1, weight = 0, reps = 0, rir = "", pump = "", felt = "", rest = "") {
      const tbody = document.getElementById("table-body");
      const row = document.createElement("tr");

      row.innerHTML = `
        <td><input type="text" value="${exercise}" onchange="updateTotals()"></td>
        <td><input type="number" value="${sets}" min="1" onchange="updateTotals()"></td>
        <td><input type="number" value="${weight}" min="0" onchange="updateRow(this)"></td>
        <td class="delta-weight">0</td>
        <td><input type="number" value="${reps}" min="0" onchange="updateRow(this)"></td>
        <td><input type="text" value="${rir}" onchange="updateTotals()"></td>
        <td><input type="text" value="${pump}" onchange="updateTotals()"></td>
        <td><input type="text" value="${felt}" onchange="updateTotals()"></td>
        <td><input type="text" value="${rest}" onchange="updateTotals()"></td>
        <td class="e1rm">0</td>
        <td><button onclick="deleteRow(this)">❌</button></td>
      `;

      tbody.appendChild(row);
      updateRow(row.querySelector("input[type='number']"));
    }

    function deleteRow(button) {
      button.closest("tr").remove();
      updateTotals();
    }

    function updateRow(input) {
      const row = input.closest("tr");
      const weight = parseFloat(row.querySelector("td:nth-child(3) input").value) || 0;
      const reps = parseFloat(row.querySelector("td:nth-child(5) input").value) || 0;

      // Calculate e1RM (Epley formula)
      const e1rm = reps > 1 ? Math.round(weight * (1 + reps / 30)) : weight;
      row.querySelector(".e1rm").textContent = e1rm;

      // Calculate ∆Weight compared to previous row
      const prevRow = row.previousElementSibling;
      if (prevRow) {
        const prevWeight = parseFloat(prevRow.querySelector("td:nth-child(3) input").value) || 0;
        row.querySelector(".delta-weight").textContent = (weight - prevWeight).toFixed(1);
      } else {
        row.querySelector(".delta-weight").textContent = "0";
      }

      updateTotals();
    }

    function updateTotals() {
      const rows = document.querySelectorAll("#table-body tr");
      let totalVolume = 0;
      let totalSets = 0;

      rows.forEach(row => {
        const sets = parseFloat(row.querySelector("td:nth-child(2) input").value) || 0;
        const weight = parseFloat(row.querySelector("td:nth-child(3) input").value) || 0;
        const reps = parseFloat(row.querySelector("td:nth-child(5) input").value) || 0;

        totalVolume += sets * weight * reps;
        totalSets += sets;
      });

      let category = "Low";
      if (totalVolume > 10000) category = "High";
      else if (totalVolume > 5000) category = "Moderate";

      document.getElementById("total-volume").textContent =
        `Total Volume: ${totalVolume} lbs | Total Sets: ${totalSets} | Volume Category: ${category}`;
    }

    function saveWorkout() {
      const rows = document.querySelectorAll("#table-body tr");
      const data = [];

      rows.forEach(row => {
        const exercise = row.querySelector("td:nth-child(1) input").value;
        const sets = row.querySelector("td:nth-child(2) input").value;
        const weight = row.querySelector("td:nth-child(3) input").value;
        const delta = row.querySelector(".delta-weight").textContent;
        const reps = row.querySelector("td:nth-child(5) input").value;
        const rir = row.querySelector("td:nth-child(6) input").value;
        const pump = row.querySelector("td:nth-child(7) input").value;
        const felt = row.querySelector("td:nth-child(8) input").value;
        const rest = row.querySelector("td:nth-child(9) input").value;
        const e1rm = row.querySelector(".e1rm").textContent;

        data.push({ exercise, sets, weight, delta, reps, rir, pump, felt, rest, e1rm });
      });

      const notes = document.getElementById("notes").value;

      console.log("Workout Saved:", { data, notes });
      alert("Workout saved! Check console for details.");
    }
  </script>
</body>
</html>
