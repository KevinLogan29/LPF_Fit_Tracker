<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Limitless Performance and Fitness</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background:black; color:#7ed957; }
    header { background:black; border-bottom:2px solid #7ed957; padding:10px; text-align:center; }
    nav { display:flex; justify-content:center; gap:10px; padding:10px; border-bottom:1px solid #7ed957; flex-wrap:wrap; }
    nav a { color:#7ed957; text-decoration:none; padding:5px 10px; border:1px solid #7ed957; border-radius:4px; }
    nav a:hover { background:#7ed957; color:black; }
    .page { display:none; padding:20px; }
    .active { display:block; }
    table { width:100%; border-collapse:collapse; margin-bottom:20px; border:1px solid #7ed957; }
    th,td { border:1px solid #7ed957; padding:6px; text-align:left; color:#7ed957; background:black; }
    th { background:black; }
    input, select, textarea { width:100%; padding:5px; box-sizing:border-box; background:black; color:#7ed957; border:1px solid #7ed957; }
    button { background:black; color:#7ed957; padding:6px 10px; border:1px solid #7ed957; border-radius:4px; cursor:pointer; }
    button:hover { background:#7ed957; color:black; }
    #total-volume { font-weight:bold; }
    .calc-section { margin-bottom: 30px; padding: 15px; border: 1px solid #7ed957; border-radius: 4px; }
    .calc-section h3 { margin-top: 0; }
    .result { font-weight: bold; background: #111; padding: 10px; margin-top: 10px; border-radius: 4px; }
    .delta { color: #7ed957; }
    .delta.positive { color: #7ed957; }
    .delta.negative { color: #d9577e; }
    .notes { background: #111; padding: 10px; margin: 10px 0; border-radius: 4px; border:1px solid #7ed957; }
    .date-input { width: auto; display: inline-block; margin-bottom: 10px; }
  </style>
</head>
<body>
  <header>
    <h1>Limitless Performance and Fitness</h1>
  </header>

  <!-- Navigation -->
  <nav>
    <a href="#" onclick="showPage('workout')">Workout Log</a>
    <a href="#" onclick="showPage('daily')">Daily Comments</a>
    <a href="#" onclick="showPage('nutrition')">Nutrition</a>
    <a href="#" onclick="showPage('cardio')">Cardio</a>
    <a href="#" onclick="showPage('performance')">Performance</a>
    <a href="#" onclick="showPage('calculators')">Calculators</a>
    <a href="#" onclick="showPage('progress')">Weekly Progress</a>
    <a href="#" onclick="showPage('hypertrophy')">Hypertrophy Blocks</a>
    <a href="#" onclick="showPage('strength')">Strength Blocks</a>
    <a href="#" onclick="showPage('mesocycle')">Mesocycles</a>
    <a href="#" onclick="showPage('history')">Workout History</a>
    <a href="#" onclick="showPage('analytics')">Analytics</a>
  </nav>

  <!-- Workout Log -->
  <div id="workout" class="page active">
    <h2>Workout Log</h2>
    <div class="date-input">
      <label for="workout-date">Date:</label>
      <input type="date" id="workout-date">
    </div>
    <table id="workout-table">
      <thead>
        <tr>
          <th>Exercise</th><th>Sets</th><th>Weight</th><th>âˆ†Weight</th><th>Reps</th>
          <th>RIR</th><th>Pump</th><th>Felt</th><th>Rest</th><th>e1RM</th><th>Actions</th>
        </tr>
      </thead>
      <tbody id="table-body"></tbody>
      <tfoot>
        <tr>
          <td colspan="9" id="total-volume">Total Volume: 0 lbs | Total Sets: 0 | Volume Category: Low</td>
          <td colspan="2">
            <button onclick="addSet()">Add Set</button>
            <button onclick="saveWorkout()">Save Workout</button>
          </td>
        </tr>
      </tfoot>
    </table>
    <h3>Notes</h3>
    <textarea id="notes" rows="4" placeholder="Additional notes..."></textarea>
  </div>

  <!-- Daily -->
  <div id="daily" class="page">
    <h2>Daily Comments</h2>
    <table id="daily-table">
      <thead>
        <tr><th>Date</th><th>Joint Pain</th><th>Warmups Felt</th><th>Tiredness</th>
            <th>Soreness</th><th>Desire</th><th>Notes</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="addDaily()">Add Day</button>
    <button onclick="saveDaily()">Save Daily Log</button>
  </div>

  <!-- Nutrition -->
  <div id="nutrition" class="page">
    <h2>Nutrition & Lifestyle</h2>
    <table id="nutrition-table">
      <thead>
        <tr><th>Date</th><th>Calories</th><th>Weight</th><th>Steps</th>
            <th>Fats</th><th>Carbs</th><th>Proteins</th><th>Sleep</th><th>Resting HR</th><th>HRV</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="addNutrition()">Add Day</button>
    <button onclick="saveNutrition()">Save Nutrition Log</button>
  </div>

  <!-- Cardio -->
  <div id="cardio" class="page">
    <h2>Cardio</h2>
    <table id="cardio-table">
      <thead>
        <tr><th>Date</th><th>Exercise</th><th>Minutes</th><th>Speed (mph)</th><th>Incline</th><th>Heart Rate Avg</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="addCardio()">Add Session</button>
    <button onclick="saveCardio()">Save Cardio Log</button>
  </div>

  <!-- Performance -->
  <div id="performance" class="page">
    <h2>Performance Tracking</h2>
    <table id="performance-table">
      <thead>
        <tr><th>Date</th><th>Lift</th><th>e1RM</th><th>Status</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="addPerformance()">Add Entry</button>
    <button onclick="savePerformance()">Save Performance Log</button>
  </div>

  <!-- Calculators -->
  <div id="calculators" class="page">
    <h2>Calculators</h2>
    
    <div class="calc-section">
      <h3>1RM Calculator (Brzycki Formula)</h3>
      <input type="number" id="calc1-weight" placeholder="Weight Lifted (lbs)" onchange="calc1RM()">
      <input type="number" id="calc1-reps" placeholder="Reps Performed" onchange="calc1RM()">
      <div id="calc1-result" class="result"></div>
    </div>
    
    <div class="calc-section">
      <h3>BMI Calculator</h3>
      <select id="bmi-unit">
        <option value="imperial">lbs / inches</option>
        <option value="metric">kg / cm</option>
      </select>
      <input type="number" id="bmi-weight" placeholder="Weight" onchange="calcBMI()">
      <input type="number" id="bmi-height" placeholder="Height" onchange="calcBMI()">
      <div id="bmi-result" class="result"></div>
    </div>
    
    <div class="calc-section">
      <h3>BMR / TDEE Calculator (Harris-Benedict)</h3>
      <input type="number" id="bmr-age" placeholder="Age (years)">
      <select id="bmr-gender">
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
      <input type="number" id="bmr-weight" placeholder="Weight (lbs)">
      <input type="number" id="bmr-height" placeholder="Height (inches)">
      <select id="bmr-activity">
        <option value="1.2">Sedentary</option>
        <option value="1.375">Lightly Active</option>
        <option value="1.55">Moderately Active</option>
        <option value="1.725">Very Active</option>
        <option value="1.9">Extra Active</option>
      </select>
      <button onclick="calcBMR()">Calculate</button>
      <div id="bmr-result" class="result"></div>
    </div>
    
    <div class="calc-section">
      <h3>Macro Calculator</h3>
      <input type="number" id="macro-tdee" placeholder="TDEE (from above)">
      <select id="macro-goal">
        <option value="bulk">Bulking (+250 cal)</option>
        <option value="cut">Cutting (-500 cal)</option>
        <option value="maintain">Maintenance</option>
      </select>
      <button onclick="calcMacros()">Calculate</button>
      <div id="macro-result" class="result"></div>
    </div>
    
    <div class="calc-section">
      <h3>Wilks Score Calculator</h3>
      <select id="wilks-gender">
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
      <input type="number" id="wilks-bw" placeholder="Bodyweight (lbs)">
      <input type="number" id="wilks-squat" placeholder="Squat 1RM (lbs)">
      <input type="number" id="wilks-bench" placeholder="Bench 1RM (lbs)">
      <input type="number" id="wilks-dead" placeholder="Deadlift 1RM (lbs)">
      <button onclick="calcWilks()">Calculate</button>
      <div id="wilks-result" class="result"></div>
    </div>
  </div>

  <!-- Weekly Progress -->
  <div id="progress" class="page">
    <h2>Weekly Progress Tracking</h2>
    <h3>Total Volume Load</h3>
    <table id="volume-table">
      <thead>
        <tr><th>Exercise</th><th>Week 1</th><th>Week 2</th><th>Week 3</th><th>Week 4</th><th>Week 5</th><th>Week 6</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <h3>e1RM</h3>
    <table id="e1rm-table">
      <thead>
        <tr><th>Exercise</th><th>Week 1</th><th>Week 2</th><th>Week 3</th><th>Week 4</th><th>Week 5</th><th>Week 6</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Hypertrophy Blocks -->
  <div id="hypertrophy" class="page">
    <h2>Muscle Hypertrophy Block Tracking</h2>
    <table id="hypertrophy-table">
      <thead>
        <tr>
          <th>Muscle</th>
          <th>Average volume from the beginning of the block</th>
          <th>Average volume from the end of the block</th>
          <th>Average sets from the beginning of the block</th>
          <th>Average sets from the end of the block</th>
          <th>Average frequency during the block</th>
          <th>Average RPE for the block</th>
          <th>Block #</th>
          <th>Block length in months</th>
          <th>Goal for this block</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="notes">
      For hypertrophy training the goal should always be to build more volume and overall mass of the muscles that you want stronger in a particular lift. i.e, for deadlift, more posterior chain work for the traps, lats, lower back/spinal erectors, glutes, and hamstrings. Prioritize which exercises you want to build the most muscle for within the Macrocycle, i.e 1.) Deadlift 2.) Bench 3.) Squat
    </div>
    <button onclick="saveHypertrophy()">Save Hypertrophy Data</button>
  </div>

  <!-- Strength Blocks -->
  <div id="strength" class="page">
    <h2>Exercise Strength Block Tracking</h2>
    <table id="strength-table">
      <thead>
        <tr>
          <th>Exercise</th>
          <th>Average total volume load at the beginning of the block</th>
          <th>Average total volume load at the end of the block</th>
          <th>Average E1rm at the beginning of the block</th>
          <th>Average E1rm at the end of the block</th>
          <th>Block #</th>
          <th>Block length in months</th>
          <th>Goal for this block</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <h3>Rep Max Progression</h3>
    <table id="rep-max-table">
      <thead>
        <tr><th>Lift</th><th>1RM</th><th>2RM</th><th>3RM</th><th>4RM</th><th>5RM</th><th>6RM</th><th>7RM</th><th>8RM</th><th>9RM</th><th>10RM</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="saveRepMax()">Save Rep Max Progression</button>
    <h3>Sticking Points</h3>
    <table id="sticking-points-table">
      <thead>
        <tr>
          <th>Lift</th>
          <th>Off Floor/Chest/Bottom</th>
          <th>Mid-Range</th>
          <th>Lockout</th>
          <th>Notes/Exercises</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="saveStickingPoints()">Save Sticking Points</button>
    <div class="notes">
      <h3>Troubleshoot guide</h3>
      <ul>
        <li>Target muscle strengthening using isolation work</li>
        <li>ROM-specific training using partial repetitions</li>
        <li>Development of momentum preceding the sticking point</li>
        <li>Exercise technique alteration</li>
        <li>Accommodating or variable resistance use</li>
      </ul>
      For strength training the goal should always be to build on sticking points and train between 1-5 reps with â‰§ 80% of 1rm/e1rm for the goal exercise while lower reps each week and increasing weight and, Add more sets instead of reps if volume is too low at higher intensities. i.e, for deadlifts, if a stick point is near mid shin, rack pulls and block pulls should be added, aswell as training the main lift  â‰§ 80% of 1rm/e1rm with higher frequences or more sets. Prioritize which exercises you want to build the most Strength for within the Macrocycle, i.e 1.) Deadlift 2.) Bench 3.) Squat
    </div>
    <button onclick="saveStrength()">Save Strength Data</button>
  </div>

  <!-- Mesocycles -->
  <div id="mesocycle" class="page">
    <h2>Mesocycle Nutrition & Recovery</h2>
    <table id="mesocycle-table">
      <thead>
        <tr>
          <th>Mesocycle</th><th>Calories</th><th>Weight</th><th>Steps</th><th>Fats</th><th>Carbs</th><th>Proteins</th><th>Sleep</th><th>Resting HR(in the morning)</th><th>HRV(ms)</th><th>Block #</th><th>Block length in months</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="notes">
      Goal for this block:
    </div>
    <textarea id="meso-goal" rows="3" placeholder="Enter goal for this block..."></textarea>
    <button onclick="saveMesocycle()">Save Mesocycle Data</button>
  </div>

  <!-- History -->
  <div id="history" class="page">
    <h2>Workout History</h2>
    <table id="history-table">
      <thead>
        <tr><th>Date</th><th>Total Volume (lbs)</th><th>Notes</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Analytics -->
  <div id="analytics" class="page">
    <h2>Performance Analytics</h2>
    <canvas id="e1rmChart" style="max-height:400px;background:#111;"></canvas>
    <h3>Descriptive Statistics</h3>
    <table id="stats-table"><thead>
      <tr><th>Lift</th><th>First</th><th>Latest</th><th>Best</th><th>Average</th><th>Progress %</th></tr>
    </thead><tbody></tbody></table>
  </div>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

  <!-- JS -->
  <script>
    function showPage(id) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if (id === "history") loadHistory();
      if (id === "analytics") loadAnalytics();
      if (id === "progress") loadProgress();
      if (id === "hypertrophy") loadHypertrophy();
      if (id === "strength") { loadStrength(); loadRepMax(); loadStickingPoints(); }
      if (id === "mesocycle") loadMesocycle();
      if (id === "workout") setWorkoutDate();
    }

    function setWorkoutDate() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("workout-date").value = today;
    }

    const exercises = [
      "Lb Squat", "Bench Press", "Deadlift", "BB rows", "HB squats", "Romanian deadlifts",
      "Rack pulls", "Close grip bench", "Incline bb bench", "Flat db bench", "Incline db bench",
      "Seated bb shoulder press", "Overhead press", "Seated db shoulder press", "Side lateral raises",
      "Cable upright rows", "Rear delt flies", "BB curls", "Db curls", "Bb preacher curls",
      "Cable preacher curls", "Ez bar curls", "Ez bar preacher curls", "Seated db curls",
      "Triceps pushdowns", "Single arm overhead triceps extensions", "Dips", "Skull crushers",
      "Single arm triceps pushdowns", "Leg press", "Leg extensions", "Hack squats",
      "Bulgarian Split squats", "Db lunges", "Goblet squats", "Front squats",
      "Leg curls standing", "Lying leg curls", "Stiff leg bb deadlifts", "Stiff leg db deadlifts",
      "Good mornings", "Hip thrusts", "Leg press calf raises", "Standing calf raises",
      "Seated calf raises", "Cable crunch", "Hanging leg raises", "Leg raises",
      "Db wrist curls", "BB wrist curls", "BB Shrugs", "DB Shrugs", "Seated rows",
      "Plate loaded row machine", "Db rows", "Assisted pull ups", "Pull ups",
      "Lat pull downs", "Bb upright rows", "Machine side laterals", "Chest press machine",
      "Guillotine Press", "Machine Pec Deck"
    ];

    const muscles = [
      "Pecs", "Lats", "Front Delt", "Rear Delt", "Side Delt", "Quads", "Hamstrings", "Calves",
      "Triceps", "Biceps", "Glutes", "Forearms", "Abs", "Traps", "Low back/ Spinal erectors"
    ];

    const initialHypertrophy = {
      "Pecs": {volStart: 7055, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Lats": {volStart: 13722, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Front Delt": {volStart: 2460, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Rear Delt": {volStart: 1380, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Side Delt": {volStart: 2400, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Quads": {volStart: 12489, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Hamstrings": {volStart: 7205, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Calves": {volStart: 21840, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Triceps": {volStart: 5955, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Biceps": {volStart: 2740, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Glutes": {volStart: 14454, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Forearms": {volStart: 4200, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Abs": {volStart: 7771, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Traps": {volStart: 2880, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""},
      "Low back/ Spinal erectors": {volStart: 2880, volEnd: "", setsStart: "", setsEnd: "", freq: "", rpe: "", block: "", length: "", goal: ""}
    };

    const initialStickingPoints = {
      "Squat": {off: "Weakness in hole; pause squats, box squats", mid: "Struggling at parallel; tempo squats", lockout: "Good", notes: "Focus on quad strength"},
      "Bench Press": {off: "Stuck off chest; close-grip bench, board presses", mid: "Mid-range stall; spoto presses", lockout: "Triceps fatigue; pin presses", notes: "Improve lockout with overhead work"},
      "Deadlift": {off: "Can't break floor; deficit deadlifts", mid: "Mid-shin stall; rack pulls", lockout: "Lockout weak; RDLs, good mornings", notes: "Posterior chain emphasis"}
    };

    const suggestions = {
      'Squat': {
        'bottom': ['Pause Squats', 'Box Squats', 'Front Squats', 'Tempo Squats', 'Belt Squats'],
        'mid': ['Hack Squats', 'Leg Press', 'Split Squats', 'Hip Thrusts', 'Romanian Deadlifts'],
        'lockout': ['Pin Squats', 'Safety Bar Squats', 'Step Ups', 'Leg Extensions', 'Backward Sled Drag']
      },
      'Bench Press': {
        'bottom': ['Spoto Press', 'Larsen Press', 'Dumbbell Bench Press', 'Chest Dips', 'Wide Grip Bench Press'],
        'mid': ['Close Grip Bench', 'Board Presses', 'JM Press', 'Incline Bench', 'Floor Press'],
        'lockout': ['Pin Press', 'Overhead Press', 'Tricep Extensions', 'High Rep Bench', 'Upright Rows']
      },
      'Deadlift': {
        'bottom': ['Deficit Deadlifts', 'Glute Ham Raises', 'Deficit RDLs', 'Beltless Paused Deadlifts'],
        'mid': ['Rack Pulls', 'Good Mornings', 'Romanian Deadlifts', 'Kettlebell Swings'],
        'lockout': ['Barbell Holds', 'Pull-ups', 'Pendlay Rows', 'Forearm Curls', 'Axle Bar Deadlifts']
      }
    };

    /* -------------------- WORKOUT -------------------- */
    let setNumber = 0;
    function addSet(ex="Exercise", wt="", reps="", rir="", pump="No", felt="", rest=120, e1rm=0) {
      setNumber++;
      const tr = document.createElement("tr");
      tr.className = "set-row";
      tr.innerHTML = `
        <td><input value="${ex}" onchange="calculateAll()"></td>
        <td>${setNumber}</td>
        <td><input type="number" value="${wt}" onchange="calculateAll()"></td>
        <td><span class="delta"></span></td>
        <td><input type="number" value="${reps}" onchange="calculateAll()"></td>
        <td><input type="number" value="${rir}" onchange="calculateAll()"></td>
        <td><select onchange="calculateAll()"><option ${pump==="No"?"selected":""}>No</option><option ${pump==="Yes"?"selected":""}>Yes</option></select></td>
        <td><input value="${felt}"></td>
        <td><input type="number" value="${rest}" onchange="calculateAll()"></td>
        <td><span>${e1rm}</span></td>
        <td><button onclick="this.closest('tr').remove();updateSetNumbers();calculateAll()">Remove</button></td>`;
      document.getElementById("table-body").appendChild(tr);
      calculateAll();
    }

    function updateSetNumbers() {
      const rows=document.querySelectorAll("#table-body .set-row");
      rows.forEach((r,i)=>r.cells[1].textContent=i+1);
      setNumber=rows.length;
    }

    function calculateAll() {
      let vol=0, sets=0;
      let prevWeight = 0;
      document.querySelectorAll("#table-body .set-row").forEach((r, index) => {
        const w=+r.cells[2].querySelector("input").value||0;
        const reps=+r.cells[4].querySelector("input").value||0;
        const rirI=r.cells[5].querySelector("input"); let rir=+rirI.value||0;
        rir=Math.max(0,Math.min(4,rir)); rirI.value=rir;
        const deltaSpan = r.cells[3].querySelector(".delta");
        if (index > 0) {
          const delta = w - prevWeight;
          deltaSpan.textContent = delta > 0 ? `+${delta}` : delta;
          deltaSpan.className = `delta ${delta > 0 ? 'positive' : (delta < 0 ? 'negative' : '')}`;
        } else {
          deltaSpan.textContent = '';
        }
        prevWeight = w;
        if(w&&reps){ vol+=w*reps; sets++; r.cells[9].querySelector("span").textContent=Math.round(w*(36/(37-reps))); }
      });
      document.getElementById("total-volume").innerHTML = `Total Volume: ${vol} lbs | Total Sets: ${sets} | Volume Category: ${getVolumeCategory(sets)}`;
    }

    function getVolumeCategory(sets) {
      if (sets < 10) return 'Low';
      if (sets < 20) return 'Medium';
      return 'High';
    }

    function saveWorkout() {
      const rows=[]; 
      document.querySelectorAll("#table-body .set-row").forEach(r=>{
        rows.push({
          exercise:r.cells[0].querySelector("input").value,
          set:r.cells[1].textContent,
          weight:r.cells[2].querySelector("input").value,
          reps:r.cells[4].querySelector("input").value,
          rir:r.cells[5].querySelector("input").value,
          pump:r.cells[6].querySelector("select").value,
          felt:r.cells[7].querySelector("input").value,
          rest:r.cells[8].querySelector("input").value,
          e1rm:r.cells[9].querySelector("span").textContent
        });
      });
      const notes=document.getElementById("notes").value;
      const dateInput = document.getElementById("workout-date").value;
      const dateKey = dateInput || new Date().toISOString().split("T")[0];
      localStorage.setItem("workout-"+dateKey,JSON.stringify({rows,notes,date:dateKey}));
      alert("Workout saved!");
    }

    /* -------------------- DAILY -------------------- */
    function addDaily(date="",pain="",warm="",tired="",sore="",desire="",notes="") {
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td><input type="date" value="${date}"></td>
        <td><input value="${pain}"></td>
        <td><input value="${warm}"></td>
        <td><input value="${tired}"></td>
        <td><input value="${sore}"></td>
        <td><input value="${desire}"></td>
        <td><textarea>${notes}</textarea></td>
        <td><button onclick="this.closest('tr').remove()">Remove</button></td>`;
      document.querySelector("#daily-table tbody").appendChild(tr);
    }
    function saveDaily() {
      const rows=[]; document.querySelectorAll("#daily-table tbody tr").forEach(r=>{
        rows.push({
          date:r.cells[0].querySelector("input").value,
          pain:r.cells[1].querySelector("input").value,
          warm:r.cells[2].querySelector("input").value,
          tired:r.cells[3].querySelector("input").value,
          sore:r.cells[4].querySelector("input").value,
          desire:r.cells[5].querySelector("input").value,
          notes:r.cells[6].querySelector("textarea").value
        });
      });
      localStorage.setItem("daily-log",JSON.stringify(rows));
      alert("Daily log saved!");
    }

    /* -------------------- NUTRITION -------------------- */
    function addNutrition(date="",cals="",weight="",steps="",fat="",carbs="",protein="",sleep="",rhr="",hrv="") {
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td><input type="date" value="${date}"></td>
        <td><input type="number" value="${cals}"></td>
        <td><input type="number" value="${weight}"></td>
        <td><input type="number" value="${steps}"></td>
        <td><input type="number" value="${fat}"></td>
        <td><input type="number" value="${carbs}"></td>
        <td><input type="number" value="${protein}"></td>
        <td><input type="number" value="${sleep}"></td>
        <td><input type="number" value="${rhr}"></td>
        <td><input type="number" value="${hrv}"></td>
        <td><button onclick="this.closest('tr').remove()">Remove</button></td>`;
      document.querySelector("#nutrition-table tbody").appendChild(tr);
    }
    function saveNutrition() {
      const rows=[]; document.querySelectorAll("#nutrition-table tbody tr").forEach(r=>{
        rows.push({
          date:r.cells[0].querySelector("input").value,
          cals:r.cells[1].querySelector("input").value,
          weight:r.cells[2].querySelector("input").value,
          steps:r.cells[3].querySelector("input").value,
          fat:r.cells[4].querySelector("input").value,
          carbs:r.cells[5].querySelector("input").value,
          protein:r.cells[6].querySelector("input").value,
          sleep:r.cells[7].querySelector("input").value,
          rhr:r.cells[8].querySelector("input").value,
          hrv:r.cells[9].querySelector("input").value
        });
      });
      localStorage.setItem("nutrition-log",JSON.stringify(rows));
      alert("Nutrition log saved!");
    }

    /* -------------------- CARDIO -------------------- */
    function addCardio(date="", exercise="", minutes="", speed="", incline="", hrAvg="") {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><input type="date" value="${date}"></td>
        <td><input value="${exercise}"></td>
        <td><input type="number" value="${minutes}"></td>
        <td><input type="number" step="0.1" value="${speed}"></td>
        <td><input type="number" step="0.1" value="${incline}"></td>
        <td><input type="number" value="${hrAvg}"></td>
        <td><button onclick="this.closest('tr').remove()">Remove</button></td>`;
      document.querySelector("#cardio-table tbody").appendChild(tr);
    }

    function saveCardio() {
      const rows = [];
      document.querySelectorAll("#cardio-table tbody tr").forEach(r => {
        rows.push({
          date: r.cells[0].querySelector("input").value,
          exercise: r.cells[1].querySelector("input").value,
          minutes: r.cells[2].querySelector("input").value,
          speed: r.cells[3].querySelector("input").value,
          incline: r.cells[4].querySelector("input").value,
          hrAvg: r.cells[5].querySelector("input").value
        });
      });
      localStorage.setItem("cardio-log", JSON.stringify(rows));
      alert("Cardio log saved!");
    }

    /* -------------------- PERFORMANCE -------------------- */
    function addPerformance(date="",lift="",e1rm="",status="") {
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td><input type="date" value="${date}"></td>
        <td><input value="${lift}"></td>
        <td><input type="number" value="${e1rm}"></td>
        <td><input value="${status}"></td>
        <td><button onclick="this.closest('tr').remove()">Remove</button></td>`;
      document.querySelector("#performance-table tbody").appendChild(tr);
    }
    function savePerformance() {
      const rows=[]; document.querySelectorAll("#performance-table tbody tr").forEach(r=>{
        rows.push({
          date:r.cells[0].querySelector("input").value,
          lift:r.cells[1].querySelector("input").value,
          e1rm:r.cells[2].querySelector("input").value,
          status:r.cells[3].querySelector("input").value
        });
      });
      localStorage.setItem("performance-log",JSON.stringify(rows));
      alert("Performance log saved!");
    }

    /* -------------------- REP MAX -------------------- */
    function loadRepMax() {
      const data = JSON.parse(localStorage.getItem("rep-max-data") || JSON.stringify([
        {lift: "Squat", values: ["",455,425,"",405,385,"","","",365]},
        {lift: "Bench", values: ["",335,325,315,"","","","","",295]},
        {lift: "Deadlift", values: ["",605,585,545,"","","","","","",""]}
      ]));
      const tbody = document.getElementById("rep-max-table").querySelector("tbody");
      tbody.innerHTML = "";
      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.lift}</td>` + row.values.map(v => `<td><input type="number" value="${v}"></td>`).join('');
        tbody.appendChild(tr);
      });
    }

    function saveRepMax() {
      const data = [];
      document.querySelectorAll("#rep-max-table tbody tr").forEach(tr => {
        const lift = tr.cells[0].textContent;
        const values = Array.from(tr.cells).slice(1).map(td => td.querySelector("input").value || "");
        data.push({lift, values});
      });
      localStorage.setItem("rep-max-data", JSON.stringify(data));
      alert("Rep Max Progression saved!");
    }

    /* -------------------- STICKING POINTS -------------------- */
    function loadStickingPoints() {
      const tb = document.querySelector("#sticking-points-table tbody");
      tb.innerHTML = "";
      let data = JSON.parse(localStorage.getItem("sticking-points-data") || JSON.stringify(initialStickingPoints));
      ["Squat", "Bench Press", "Deadlift"].forEach(lift => {
        const d = data[lift] || {off: "", mid: "", lockout: "", notes: ""};
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${lift}</td>
          <td><textarea rows="2">${d.off}</textarea></td>
          <td><textarea rows="2">${d.mid}</textarea></td>
          <td><textarea rows="2">${d.lockout}</textarea></td>
          <td><textarea rows="3">${d.notes}</textarea></td>
          <td><button onclick="this.closest('tr').remove()">Remove</button></td>
        `;
        tb.appendChild(tr);

        // Add event listeners for auto-suggestions
        const weaknessTAs = [tr.cells[1].querySelector('textarea'), tr.cells[2].querySelector('textarea'), tr.cells[3].querySelector('textarea')];
        const notesTA = tr.cells[4].querySelector('textarea');
        const phases = ['bottom', 'mid', 'lockout'];
        weaknessTAs.forEach((ta, idx) => {
          ta.addEventListener('input', function() {
            const text = this.value.toLowerCase().trim();
            if (text.length > 0 && (text.includes('weak') || text.includes('stuck') || text.includes('fail') || text.includes('struggle'))) {
              const phase = phases[idx];
              const liftKey = lift === 'Deadlift' ? 'Deadlift' : lift;
              const sugs = suggestions[liftKey] ? suggestions[liftKey][phase] || [] : [];
              if (sugs.length > 0) {
                const sugStr = sugs.slice(0, 4).join(', ');
                const existing = notesTA.value.toLowerCase();
                if (!existing.includes('auto-suggestion')) {
                  notesTA.value += `\n\nAuto-suggestion for ${phase} weakness: Consider incorporating ${sugStr}.`;
                }
              }
            }
          });
        });
      });
    }

    function saveStickingPoints() {
      const data = {};
      document.querySelectorAll("#sticking-points-table tbody tr").forEach(r => {
        const lift = r.cells[0].textContent;
        data[lift] = {
          off: r.cells[1].querySelector("textarea").value,
          mid: r.cells[2].querySelector("textarea").value,
          lockout: r.cells[3].querySelector("textarea").value,
          notes: r.cells[4].querySelector("textarea").value
        };
      });
      localStorage.setItem("sticking-points-data", JSON.stringify(data));
      alert("Sticking Points saved!");
    }

    /* -------------------- HYPERTROPHY -------------------- */
    function loadHypertrophy() {
      const tb = document.querySelector("#hypertrophy-table tbody");
      tb.innerHTML = "";
      let data = JSON.parse(localStorage.getItem("hypertrophy-data") || JSON.stringify(initialHypertrophy));
      muscles.forEach(m => {
        const d = data[m];
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${m}</td>
          <td><input type="number" value="${d.volStart}"></td>
          <td><input type="number" value="${d.volEnd}"></td>
          <td><input type="number" value="${d.setsStart}"></td>
          <td><input type="number" value="${d.setsEnd}"></td>
          <td><input type="number" value="${d.freq}"></td>
          <td><input type="number" value="${d.rpe}"></td>
          <td><input type="number" value="${d.block}"></td>
          <td><input type="number" value="${d.length}"></td>
          <td><input value="${d.goal}"></td>
        `;
        tb.appendChild(tr);
      });
    }

    function saveHypertrophy() {
      const data = {};
      document.querySelectorAll("#hypertrophy-table tbody tr").forEach((r, i) => {
        const m = muscles[i];
        data[m] = {
          volStart: r.cells[1].querySelector("input").value,
          volEnd: r.cells[2].querySelector("input").value,
          setsStart: r.cells[3].querySelector("input").value,
          setsEnd: r.cells[4].querySelector("input").value,
          freq: r.cells[5].querySelector("input").value,
          rpe: r.cells[6].querySelector("input").value,
          block: r.cells[7].querySelector("input").value,
          length: r.cells[8].querySelector("input").value,
          goal: r.cells[9].querySelector("input").value
        };
      });
      localStorage.setItem("hypertrophy-data", JSON.stringify(data));
      alert("Hypertrophy data saved!");
    }

    /* -------------------- STRENGTH -------------------- */
    function loadStrength() {
      const tb = document.querySelector("#strength-table tbody");
      tb.innerHTML = "";
      let data = JSON.parse(localStorage.getItem("strength-data") || "{}");
      exercises.forEach(ex => {
        const d = data[ex] || {volStart: "", volEnd: "", e1rmStart: "", e1rmEnd: "", block: "", length: "", goal: ""};
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${ex}</td>
          <td><input type="number" value="${d.volStart}"></td>
          <td><input type="number" value="${d.volEnd}"></td>
          <td><input type="number" value="${d.e1rmStart}"></td>
          <td><input type="number" value="${d.e1rmEnd}"></td>
          <td><input type="number" value="${d.block}"></td>
          <td><input type="number" value="${d.length}"></td>
          <td><input value="${d.goal}"></td>
        `;
        tb.appendChild(tr);
      });
    }

    function saveStrength() {
      const data = {};
      document.querySelectorAll("#strength-table tbody tr").forEach((r, i) => {
        const ex = exercises[i];
        data[ex] = {
          volStart: r.cells[1].querySelector("input").value,
          volEnd: r.cells[2].querySelector("input").value,
          e1rmStart: r.cells[3].querySelector("input").value,
          e1rmEnd: r.cells[4].querySelector("input").value,
          block: r.cells[5].querySelector("input").value,
          length: r.cells[6].querySelector("input").value,
          goal: r.cells[7].querySelector("input").value
        };
      });
      localStorage.setItem("strength-data", JSON.stringify(data));
      alert("Strength data saved!");
    }

    /* -------------------- MESOCYCLE -------------------- */
    function loadMesocycle() {
      const tb = document.querySelector("#mesocycle-table tbody");
      tb.innerHTML = "";
      let data = JSON.parse(localStorage.getItem("mesocycle-data") || "[]");
      for(let i=1; i<=6; i++){
        const d = data[i-1] || {cal: "", wt: "", steps: "", fats: "", carbs: "", prot: "", sleep: "", rhr: "", hrv: "", block: "", length: ""};
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>Mesocycle ${i}</td>
          <td><input type="number" value="${d.cal}"></td>
          <td><input type="number" value="${d.wt}"></td>
          <td><input type="number" value="${d.steps}"></td>
          <td><input type="number" value="${d.fats}"></td>
          <td><input type="number" value="${d.carbs}"></td>
          <td><input type="number" value="${d.prot}"></td>
          <td><input type="number" value="${d.sleep}"></td>
          <td><input type="number" value="${d.rhr}"></td>
          <td><input type="number" value="${d.hrv}"></td>
          <td><input type="number" value="${d.block}"></td>
          <td><input type="number" value="${d.length}"></td>
        `;
        tb.appendChild(tr);
      }
      document.getElementById("meso-goal").value = localStorage.getItem("meso-goal") || "";
    }

    function saveMesocycle() {
      const data = [];
      document.querySelectorAll("#mesocycle-table tbody tr").forEach(r => {
        data.push({
          cal: r.cells[1].querySelector("input").value,
          wt: r.cells[2].querySelector("input").value,
          steps: r.cells[3].querySelector("input").value,
          fats: r.cells[4].querySelector("input").value,
          carbs: r.cells[5].querySelector("input").value,
          prot: r.cells[6].querySelector("input").value,
          sleep: r.cells[7].querySelector("input").value,
          rhr: r.cells[8].querySelector("input").value,
          hrv: r.cells[9].querySelector("input").value,
          block: r.cells[10].querySelector("input").value,
          length: r.cells[11].querySelector("input").value
        });
      });
      localStorage.setItem("mesocycle-data", JSON.stringify(data));
      localStorage.setItem("meso-goal", document.getElementById("meso-goal").value);
      alert("Mesocycle data saved!");
    }

    /* -------------------- PROGRESS (Weekly) -------------------- */
    function loadProgress() {
      const volTb = document.querySelector("#volume-table tbody");
      const e1rmTb = document.querySelector("#e1rm-table tbody");
      volTb.innerHTML = "";
      e1rmTb.innerHTML = "";
      const ws = Object.keys(localStorage).filter(k=>k.startsWith("workout-"))
        .map(k=>JSON.parse(localStorage.getItem(k)))
        .filter(w => w.rows && w.rows.length > 0)
        .sort((a,b)=>new Date(a.date) - new Date(b.date));
      if(ws.length === 0) return;
      const minDate = new Date(ws[0].date);
      exercises.forEach(ex => {
        let volData = new Array(6).fill(0);
        let e1rmData = new Array(6).fill(0);
        ws.forEach(w => {
          const date = new Date(w.date);
          const diffTime = date - minDate;
          const week = Math.floor(diffTime / (7 * 24 * 60 * 60 * 1000));
          if(week >= 0 && week < 6){
            let exVol = 0;
            let maxE1rm = 0;
            w.rows.forEach(r => {
              if(r.exercise.toLowerCase().includes(ex.toLowerCase())){
                const v = parseFloat(r.weight || 0) * parseFloat(r.reps || 0);
                exVol += v;
                const e = parseFloat(r.e1rm || 0);
                if(e > maxE1rm) maxE1rm = e;
              }
            });
            volData[week] += exVol;
            if(maxE1rm > e1rmData[week]) e1rmData[week] = maxE1rm;
          }
        });
        const volRow = document.createElement("tr");
        volRow.innerHTML = `<td>${ex}</td>` + volData.map(v => `<td>${Math.round(v)}</td>`).join('');
        volTb.appendChild(volRow);
        const eRow = document.createElement("tr");
        eRow.innerHTML = `<td>${ex}</td>` + e1rmData.map(e => `<td>${Math.round(e)}</td>`).join('');
        e1rmTb.appendChild(eRow);
      });
    }

    /* -------------------- CALCULATORS -------------------- */
    function calc1RM() {
      const w = parseFloat(document.getElementById('calc1-weight').value) || 0;
      const r = parseFloat(document.getElementById('calc1-reps').value) || 0;
      if (w && r && r < 37) {
        const oneRM = Math.round(w * (36 / (37 - r)));
        document.getElementById('calc1-result').innerHTML = `Estimated 1RM: ${oneRM} lbs`;
      } else {
        document.getElementById('calc1-result').innerHTML = '';
      }
    }

    function calcBMI() {
      const unit = document.getElementById('bmi-unit').value;
      const wt = parseFloat(document.getElementById('bmi-weight').value) || 0;
      const ht = parseFloat(document.getElementById('bmi-height').value) || 0;
      let bmi = 0;
      let category = '';
      if (unit === 'imperial') {
        bmi = (wt / (ht * ht)) * 703;
      } else {
        const kg = wt * 0.453592;
        const m = ht / 100;
        bmi = kg / (m * m);
      }
      if (bmi < 18.5) category = 'Underweight';
      else if (bmi < 25) category = 'Normal';
      else if (bmi < 30) category = 'Overweight';
      else category = 'Obese';
      document.getElementById('bmi-result').innerHTML = `BMI: ${bmi.toFixed(1)} (${category})`;
    }

    function calcBMR() {
      const age = parseFloat(document.getElementById('bmr-age').value) || 0;
      const gender = document.getElementById('bmr-gender').value;
      let wtKg = (parseFloat(document.getElementById('bmr-weight').value) || 0) * 0.453592;
      let htCm = (parseFloat(document.getElementById('bmr-height').value) || 0) * 2.54;
      let bmr;
      if (gender === 'male') {
        bmr = 88.362 + (13.397 * wtKg) + (4.799 * htCm) - (5.677 * age);
      } else {
        bmr = 447.593 + (9.247 * wtKg) + (3.098 * htCm) - (4.330 * age);
      }
      const activity = parseFloat(document.getElementById('bmr-activity').value);
      const tdee = Math.round(bmr * activity);
      document.getElementById('bmr-result').innerHTML = `BMR: ${Math.round(bmr)} cal | TDEE: ${tdee} cal`;
    }

    function calcMacros() {
      const tdee = parseFloat(document.getElementById('macro-tdee').value) || 0;
      const goal = document.getElementById('macro-goal').value;
      let cals = tdee;
      if (goal === 'bulk') cals += 250;
      if (goal === 'cut') cals -= 500;
      const proteinPct = 25;
      const carbPct = goal === 'bulk' ? 55 : (goal === 'cut' ? 45 : 50);
      const fatPct = 100 - proteinPct - carbPct;
      const protein = Math.round((cals * proteinPct / 100) / 4);
      const carbs = Math.round((cals * carbPct / 100) / 4);
      const fats = Math.round((cals * fatPct / 100) / 9);
      document.getElementById('macro-result').innerHTML = `${goal.toUpperCase()} Calories: ${cals}<br>Protein: ${protein}g (${proteinPct}%) | Carbs: ${carbs}g (${carbPct}%) | Fats: ${fats}g (${fatPct}%)`;
    }

    function calcWilks() {
      const gender = document.getElementById('wilks-gender').value;
      let bwKg = (parseFloat(document.getElementById('wilks-bw').value) || 0) * 0.453592;
      const squat = (parseFloat(document.getElementById('wilks-squat').value) || 0) * 0.453592;
      const bench = (parseFloat(document.getElementById('wilks-bench').value) || 0) * 0.453592;
      const dead = (parseFloat(document.getElementById('wilks-dead').value) || 0) * 0.453592;
      const total = squat + bench + dead;
      let a, b, c, d, e, f;
      if (gender === 'male') {
        a = -216.0475144; b = 16.2606339; c = -0.002388645; d = -0.001137733; e = 0.007800223; f = -0.0006214027;
      } else {
        a = 594.31747775582; b = -27.23842536447; c = 0.82112226871; d = -0.00930733913; e = 0.000047163; f = -0.00010731147;
      }
      const denom = a + b*bwKg + c*bwKg*bwKg + d*bwKg*bwKg*bwKg + e*bwKg*bwKg*bwKg*bwKg + f*(bwKg**5);
      const wilks = total * 500 / denom;
      document.getElementById('wilks-result').innerHTML = `Total: ${Math.round(total * 2.20462)} lbs | Wilks Score: ${wilks.toFixed(2)}`;
    }

    /* -------------------- HISTORY -------------------- */
    function loadHistory() {
      const tb=document.querySelector("#history-table tbody"); tb.innerHTML="";
      const keys = Object.keys(localStorage).filter(k=>k.startsWith("workout-"));
      keys.sort((a,b)=>{
        const dateStrA = a.replace("workout-", "");
        const dateA = new Date(dateStrA);
        const dateStrB = b.replace("workout-", "");
        const dateB = new Date(dateStrB);
        return dateB - dateA;
      });
      keys.forEach(k=>{
        const d=JSON.parse(localStorage.getItem(k));
        const vol = d.rows.reduce((sum, r) => sum + (+r.weight * +r.reps), 0);
        tb.innerHTML+=`<tr>
          <td>${d.date}</td>
          <td>${Math.round(vol)}</td>
          <td>${d.notes||""}</td>
          <td>
            <button onclick="loadSpecific('${k}')">View</button>
            <button onclick="downloadCSV('${k}')">CSV</button>
            <button onclick="deleteWorkout('${k}')">Delete</button>
          </td>
        </tr>`;
      });
    }

    function loadSpecific(key) {
      const d=JSON.parse(localStorage.getItem(key));
      const tb=document.getElementById("table-body"); tb.innerHTML=""; setNumber=0;
      d.rows.forEach(r=>addSet(r.exercise,r.weight,r.reps,r.rir,r.pump,r.felt,r.rest,r.e1rm));
      document.getElementById("notes").value=d.notes;
      document.getElementById("workout-date").value = d.date;
      showPage("workout");
    }

    function downloadCSV(key) {
      const d=JSON.parse(localStorage.getItem(key));
      let csv="Exercise,Set,Weight,Delta,Reps,RIR,Pump,Felt,Rest,e1RM\n";
      d.rows.forEach(r=>{ csv+=`${r.exercise},${r.set},${r.weight},,${r.reps},${r.rir},${r.pump},${r.felt},${r.rest},${r.e1rm}\n`; });
      csv+=`Notes:,${(d.notes||"").replace(/[\n\r]/g," ")}\n`;
      const link=document.createElement("a");
      link.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
      link.download=`${d.date}-workout.csv`; link.click();
    }

    function deleteWorkout(key) {
      if (confirm("Delete this workout?")) {
        localStorage.removeItem(key);
        loadHistory();
      }
    }

    /* -------------------- ANALYTICS -------------------- */
    let e1rmChart;
    function loadAnalytics() {
      const lifts=["Squat","Bench","Deadlift"];
      const map={Squat:[],Bench:[],Deadlift:[]};
      const ws=Object.keys(localStorage).filter(k=>k.startsWith("workout-"))
        .map(k=>JSON.parse(localStorage.getItem(k)))
        .sort((a,b)=>new Date(a.date)-new Date(b.date));
      ws.forEach(w=>{
        lifts.forEach(l=>{
          const best=w.rows.filter(r=>r.exercise.toLowerCase().includes(l.toLowerCase()))
            .map(r=>+r.e1rm).filter(v=>!isNaN(v));
          if(best.length>0) map[l].push({date:w.date,e1rm:Math.max(...best)});
        });
      });
      const ctx=document.getElementById("e1rmChart").getContext("2d");
      if(e1rmChart) e1rmChart.destroy();
      e1rmChart=new Chart(ctx,{type:"line",data:{datasets:lifts.map((l,i)=>({
        label:l,data:map[l].map(d=>({x:new Date(d.date),y:d.e1rm})),
        borderColor:["#7ed957","#57c7d9","#d9577e"][i],tension:0.3
      }))},options:{scales:{x:{type:"time",time:{unit:"day"}},y:{title:{display:true,text:"e1RM"}}}}});
      const tb=document.querySelector("#stats-table tbody"); tb.innerHTML="";
      lifts.forEach(l=>{
        const vals=map[l].map(d=>d.e1rm); if(!vals.length) return;
        const first=vals[0], latest=vals[vals.length-1], best=Math.max(...vals);
        const avg=(vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(1);
        const prog=(((latest-first)/first)*100).toFixed(1);
        tb.innerHTML+=`<tr><td>${l}</td><td>${first}</td><td>${latest}</td><td>${best}</td><td>${avg}</td><td>${prog}%</td></tr>`;
      });
    }

    /* -------------------- INIT -------------------- */
    window.onload=function(){ 
      setWorkoutDate();
      addSet("Lowbar Squat",315,5,2,"No","Quads",120,354); 
      calculateAll(); 
      // Reload saved logs
      let daily=JSON.parse(localStorage.getItem("daily-log")||"[]");
      if (daily.length === 0) {
        addDaily("", "Mild discomfort", "Light", "A little tired", "Mild soreness", "High", "Upper");
        addDaily("", "Mild discomfort", "Did not train", "A little tired", "Mild soreness", "Average", "Lower");
        addDaily("", "Local joint pain discomfort", "Light", "A little tired", "Feel great", "High", "Push");
        addDaily("", "Local joint pain discomfort", "Heavy", "Tired on average", "Mild soreness", "Low", "Pull");
        addDaily("", "", "", "", "", "", "Rest day");
        daily = [
          {date: "", pain: "Mild discomfort", warm: "Light", tired: "A little tired", sore: "Mild soreness", desire: "High", notes: "Upper"},
          {date: "", pain: "Mild discomfort", warm: "Did not train", tired: "A little tired", sore: "Mild soreness", desire: "Average", notes: "Lower"},
          {date: "", pain: "Local joint pain discomfort", warm: "Light", tired: "A little tired", sore: "Feel great", desire: "High", notes: "Push"},
          {date: "", pain: "Local joint pain discomfort", warm: "Heavy", tired: "Tired on average", sore: "Mild soreness", desire: "Low", notes: "Pull"},
          {date: "", pain: "", warm: "", tired: "", sore: "", desire: "", notes: "Rest day"}
        ];
        localStorage.setItem("daily-log", JSON.stringify(daily));
      } else {
        daily.forEach(d=>addDaily(d.date,d.pain,d.warm,d.tired,d.sore,d.desire,d.notes));
      }
      const nutrition=JSON.parse(localStorage.getItem("nutrition-log")||"[]"); nutrition.forEach(n=>addNutrition(n.date,n.cals,n.weight,n.steps,n.fat,n.carbs,n.protein,n.sleep,n.rhr,n.hrv));
      const perf=JSON.parse(localStorage.getItem("performance-log")||"[]"); perf.forEach(p=>addPerformance(p.date,p.lift,p.e1rm,p.status));
      const cardio=JSON.parse(localStorage.getItem("cardio-log")||"[]");
      if (cardio.length === 0) {
        addCardio("2025-02-03", "Treadmill", 30, 3, 3, 122);
        localStorage.setItem("cardio-log", JSON.stringify([{date:"2025-02-03", exercise:"Treadmill", minutes:30, speed:3, incline:3, hrAvg:122}]));
      } else {
        cardio.forEach(c=>addCardio(c.date,c.exercise,c.minutes,c.speed,c.incline,c.hrAvg));
      }
    };
  </script>
</body>
</html>
</html>

